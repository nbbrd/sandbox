name: Heylogs badge

on: [ push ]

jobs:
  update-changelogs:
    runs-on: ubuntu-latest
    steps:

      - name: Checkout source code
        uses: actions/checkout@v4

      - name: Scan changelog and create badge content
        run: |
          mvn com.github.nbbrd.heylogs:heylogs-maven-plugin:scan -Dheylogs.format.id=json -Dheylogs.output.file=heylogs/scan.json
          jq '{schemaVersion: 1, label: "unreleased changes", message: "#\(.[0].summary.unreleasedChanges)", color: "E05735", logoColor: "white", namedLogo: "keepachangelog"}' heylogs/scan.json > heylogs/unreleased-changes.json

      - name: Deploy scan summary
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./heylogs
          destination_dir: ./heylogs
